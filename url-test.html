<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL跳转测试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
        .info { background: #f0f8ff; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .test-link { 
            display: inline-block; 
            padding: 10px 20px; 
            background: #007bff; 
            color: white; 
            text-decoration: none; 
            border-radius: 5px; 
            margin: 5px;
        }
        .test-link:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>HTMLproxy URL跳转测试</h1>
    
    <div class="info">
        <h3>当前页面信息：</h3>
        <p><strong>URL:</strong> <span id="currentUrl"></span></p>
        <p><strong>协议:</strong> <span id="protocol"></span></p>
        <p><strong>主机:</strong> <span id="hostname"></span></p>
        <p><strong>端口:</strong> <span id="port"></span></p>
    </div>

    <div class="info">
        <h3>测试链接：</h3>
        <p>后端生成的相对路径: <code>/html/qianye/test.html</code></p>
        <p>
            <a href="/html/qianye/test.html" target="_blank" class="test-link">测试相对路径</a>
            <a href="http://38.55.124.252:8080/html/qianye/test.html" target="_blank" class="test-link">测试8080端口</a>
            <a href="http://38.55.124.252:40000/html/qianye/test.html" target="_blank" class="test-link">测试40000端口</a>
        </p>
    </div>

    <div class="info">
        <h3>JavaScript URL处理测试：</h3>
        <p>
            <button onclick="testGetFileUrl()" class="test-link">测试getFileUrl函数</button>
        </p>
        <div id="testResult"></div>
    </div>

    <script>
        // 显示当前页面信息
        document.getElementById('currentUrl').textContent = window.location.href;
        document.getElementById('protocol').textContent = window.location.protocol;
        document.getElementById('hostname').textContent = window.location.hostname;
        document.getElementById('port').textContent = window.location.port || '默认端口';

        // 模拟前端的getFileUrl函数
        function getFileUrl(url) {
            console.log('原始URL:', url);
            console.log('当前location:', {
                protocol: window.location.protocol,
                hostname: window.location.hostname,
                port: window.location.port,
                origin: window.location.origin
            });
            
            if (url.startsWith('http://') || url.startsWith('https://')) {
                console.log('完整URL，直接返回:', url);
                return url;
            }
            
            if (url.startsWith('/html/') && window.location.port === '40000') {
                const newUrl = window.location.protocol + '//' + window.location.hostname + ':8080' + url;
                console.log('重定向到nginx端口:', newUrl);
                return newUrl;
            }
            
            console.log('使用相对路径:', url);
            return url;
        }

        function testGetFileUrl() {
            const testUrl = '/html/qianye/test.html';
            const result = getFileUrl(testUrl);
            
            document.getElementById('testResult').innerHTML = `
                <p><strong>输入:</strong> ${testUrl}</p>
                <p><strong>输出:</strong> ${result}</p>
                <p><strong>测试链接:</strong> <a href="${result}" target="_blank">${result}</a></p>
            `;
        }
    </script>
</body>
</html>